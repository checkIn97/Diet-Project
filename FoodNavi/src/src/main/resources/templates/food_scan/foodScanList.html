<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<th:block th:insert="~{/includes/headerMain}"></th:block>
<head>
<meta charset="UTF-8">
<title>Food Navigator</title>
<script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
</head>
<body>
	<h2><a href="food_scan">Food Search</a></h2>
	
	<!-- 검색 또는 추천 조건값을 설정하는 영역 -->
	<form name="scanForm" id="scanForm" method="post">
		<input type="hidden" name="page" value=0>
		<table>
			<tr>
				<td>검색단어</td>
				<td>
					<select name="searchField">
						<th:block th:each="field : ${foodScanVo.searchType}">
							<th:block th:if="${field[0] == foodScanVo.searchField}">
								<option th:value="${field[0]}" selected>[[${field[1]}]]</option>
							</th:block>
							<th:block th:unless="${field[0] == foodScanVo.searchField}">
								<option th:value="${field[0]}">[[${field[1]}]]</option>
							</th:block>						
						</th:block>
					</select>
				</td>
				<td>
					<input type="text" name="searchWord" th:value="${foodScanVo.searchWord}"/>
				</td>
				<td>제외단어</td>
				<td>
					<select name="banField">
						<th:block th:each="field : ${foodScanVo.searchType}">
							<th:block th:if="${field[0] == foodScanVo.banField}">
								<option th:value="${field[0]}" selected>[[${field[1]}]]</option>
							</th:block>
							<th:block th:unless="${field[0] == foodScanVo.banField}">
								<option th:value="${field[0]}">[[${field[1]}]]</option>
							</th:block>						
						</th:block>
					</select>
				</td>
				<td>
					<input type="text" name="banWord" th:value="${foodScanVo.banWord}"/>
				</td>
				<td>
					<input type="button" value="검색" onclick="food_scan()"/>
				</td>
			</tr>
			<tr>
				<td>
					<select name="tasteField">
						<th:block th:each="field : ${foodScanVo.tasteType}">
							<th:block th:if="${field[0] == foodScanVo.tasteField}">
								<option th:value="${field[0]}" selected>[[${field[1]}]]</option>
							</th:block>
							<th:block th:unless="${field[0] == foodScanVo.tasteField}">
								<option th:value="${field[0]}">[[${field[1]}]]</option>
							</th:block>						
						</th:block>
					</select>
				</td>
				<td>
					<select name="weightField">
						<th:block th:each="field : ${foodScanVo.weightType}">
							<th:block th:if="${field[0] == foodScanVo.weightField}">
								<option th:value="${field[0]}" selected>[[${field[1]}]]</option>
							</th:block>
							<th:block th:unless="${field[0] == foodScanVo.weightField}">
								<option th:value="${field[0]}">[[${field[1]}]]</option>
							</th:block>						
						</th:block>
					</select>
				</td>
				<td>
					<select name="veganField">
						<th:block th:each="field : ${foodScanVo.veganType}">
							<th:block th:if="${field[0] == foodScanVo.veganField}">
								<option th:value="${field[0]}" selected>[[${field[1]}]]</option>
							</th:block>
							<th:block th:unless="${field[0] == foodScanVo.veganField}">
								<option th:value="${field[0]}">[[${field[1]}]]</option>
							</th:block>						
						</th:block>
					</select>
				</td>
				<td>
					<select name="nationField">
						<th:block th:each="field : ${foodScanVo.nationType}">
							<th:block th:if="${field[0] == foodScanVo.nationField}">
								<option th:value="${field[0]}" selected>[[${field[1]}]]</option>
							</th:block>
							<th:block th:unless="${field[0] == foodScanVo.nationField}">
								<option th:value="${field[0]}">[[${field[1]}]]</option>
							</th:block>						
						</th:block>
					</select>
				</td>
				<td>
					<select name="healthyField">
						<th:block th:each="field : ${foodScanVo.healthyType}">
							<th:block th:if="${field[0] == foodScanVo.healthyField}">
								<option th:value="${field[0]}" selected>[[${field[1]}]]</option>
							</th:block>
							<th:block th:unless="${field[0] == foodScanVo.healthyField}">
								<option th:value="${field[0]}">[[${field[1]}]]</option>
							</th:block>						
						</th:block>
					</select>
				</td>
				<td>
					<select name="meahField">
						<th:block th:each="field : ${foodScanVo.mealType}">
							<th:block th:if="${field[0] == foodScanVo.mealField}">
								<option th:value="${field[0]}" selected>[[${field[1]}]]</option>
							</th:block>
							<th:block th:unless="${field[0] == foodScanVo.mealField}">
								<option th:value="${field[0]}">[[${field[1]}]]</option>
							</th:block>						
						</th:block>
					</select>
				</td>
				<td>
					<input type="button" value="추천검색" onclick="food_recommend()"/>
				</td>
			</tr>
		</table>
		<br>
	</form>
	<!-- 리스트가 입력되는 영역 -->
	<th:block id="list_insert" th:insert="~{/food_scan/include/food_list_area}"></th:block>
	
	<!-- 리스트에 맞게 페이지가 입력되는 영역 -->
	<!-- 리스트의 사이즈가 0인 경우에는 표시되지 않음 -->
    <th:block id="page_insert" th:if="${pageInfo.totalPages != 0}" th:insert="~{/food_scan/include/food_page_area}"></th:block>
</body>
<script>
function food_scan() {
	$("#scanForm").attr("action", "food_scan").submit();
}

function food_recommend() {
	$("#scanForm").attr("action", "food_recommend").submit();
}

function food_scan_ajax() {

	$.ajax({
		type: 'post',
		url: '/food_scan_ajax',
		dataType: 'json',   // 서버로 전달할 데이터 형식
		data: $("#scanForm").serialize(), // 여러 데이터를 차례대로 전송
		headers: {
			Accept: "application/json; charset=utf-8",
			"Content-type": "application/json; charset=utf-8"
		},
		success: function(data) {
			foodList = data.foodList;
			alert(foodList.length);
			HTML = "<th:block id=\"list_insert\" th:insert=\"~{/food_scan/include/list_area}\"></th:block>";
			$("#list_insert").html(HTML);
		},
		error: function(request, status, error) {
			alert("테스트");
		}
	});
}


function food_scan_ajax0() {

	$.ajax({
		type: 'post',
		url: '/food_scan_ajax',
		dataType: 'json',   // 서버로 전달할 데이터 형식
		data: $("#scanForm").serialize(), // 여러 데이터를 차례대로 전송
		headers: {
			Accept: "application/json; charset=utf-8",
			"Content-type": "application/json; charset=utf-8"
		},
		success: function(data) {
			foodList = data.foodList;
			alert(foodList.length);
			HTML = "";
			HTML += '<table>';
			HTML += '<tr>';
			HTML += '<th>이미지</th>';
			HTML += '<th>이름</th>';
			HTML += '<th>칼로리</th>';
			HTML += '<th>추천수</th>';
			HTML += '</tr>';
			if (foodList.length == 0) {
				HTML += '<tr><td colspan=4><span>조건에 맞는 대상이 없습니다.</span></td></tr>';
			} else {
				$.each(foodList, function(index, food) {
					HTML += '<tr>';
					if (food.img == null) {
						HTML += '<td>없음</td>';
					} else {
						HTML += '<td>있음</td>';	
					}
					HTML += '<td>' + food.name + '</td>';
					HTML += '<td>' + food.foodDetail.kcal + '</td>';
					HTML += '<td>' + '' + '</td>';
					HTML += '</tr>';
				});
			}
			HTML += '</table>';
			alert(HTML);
			$("#foodList").html(HTML);
		},
		error: function(request, status, error) {
			alert("테스트3");
		}
	});
}

</script>
</html>
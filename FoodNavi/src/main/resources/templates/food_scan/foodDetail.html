<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<th:block th:insert="~{/includes/headerMain}"></th:block>
<head>
    <meta charset="UTF-8">
    <title>Food Navigator</title>
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"
            integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
</head>
<style>
    table {
        border: 1px solid black;
        width: 1600px;
        border-collapse: collapse;
    }

    th, td {
        border: 1px solid black;
    }
</style>
<body>
<h2>Food Detail</h2>
<form name="food_detail_form" id="food_detail_form" method="post">
    <table>
        <tr>
            <th>이미지</th>
            <td>내용</td>
        </tr>
        <tr>
            <th>이름</th>
            <td>[[${foodVo.food.name}]]</td>
        </tr>
        <tr>
            <th>칼로리</th>
            <td>[[${foodVo.food.foodDetail.kcal}]] kcal</td>
        </tr>
        <tr>
            <th th:rowspan="3">영양성분</th>
            <td th:rowspan="3">
                <canvas id="foodChart" width="500vw" height="500vh"></canvas>
            </td>
            <!--<th>탄수화물</th>-->
            <!--<td>[[${foodVo.food.foodDetail.carb}]] g</td>-->
        </tr>
        <tr>
            <!--<th>단백질</th>-->
            <!--<td>[[${foodVo.food.foodDetail.prt}]] g</td>-->
        </tr>
        <tr>
            <!--<th>지방</th>-->
            <!--<td>[[${foodVo.food.foodDetail.fat}]] g</td>-->
        </tr>
        <th:block th:if="${foodScanVo.recommend}">
	        <tr>
	            <th>추천점수</th>
	            <td>
	            	<span class="satisfaction">
				    	<img class="star" th:if="${foodVo.starScore == 0}" src="/assets/images/star-empty.png">
				    	<img class="star" th:if="${foodVo.starScore == 1}" src="/assets/images/star-half.png">
				    	<img class="star" th:if="${foodVo.starScore >= 2}" src="/assets/images/star-full.png">
				    	<img class="star" th:if="${foodVo.starScore <= 2}" src="/assets/images/star-empty.png">
				    	<img class="star" th:if="${foodVo.starScore == 3}" src="/assets/images/star-half.png">
				    	<img class="star" th:if="${foodVo.starScore >= 4}" src="/assets/images/star-full.png">
				    	<img class="star" th:if="${foodVo.starScore <= 4}" src="/assets/images/star-empty.png">
				    	<img class="star" th:if="${foodVo.starScore == 5}" src="/assets/images/star-half.png">
				    	<img class="star" th:if="${foodVo.starScore >= 6}" src="/assets/images/star-full.png">
				    	<img class="star" th:if="${foodVo.starScore <= 6}" src="/assets/images/star-empty.png">
				    	<img class="star" th:if="${foodVo.starScore == 7}" src="/assets/images/star-half.png">
				    	<img class="star" th:if="${foodVo.starScore >= 8}" src="/assets/images/star-full.png">
				    	<img class="star" th:if="${foodVo.starScore <= 8}" src="/assets/images/star-empty.png">
				    	<img class="star" th:if="${foodVo.starScore == 9}" src="/assets/images/star-half.png">
				    	<img class="star" th:if="${foodVo.starScore >= 10}" src="/assets/images/star-full.png">
    				</span>		
			    </td>
	        </tr>
        </th:block>
        <tr>
            <th>좋아요</th>
            <td id="rcdCount" onclick="rcd_update(); return false;">
            	<span th:if="${rcdStatus.rcdStatus == 0}">[[${rcdStatus.rcdCount}]]</span>
            	<span th:if="${rcdStatus.rcdStatus == 1}" style="color:red">[[${rcdStatus.rcdCount}]]</span>
           	</td>
        </tr>
    </table>
    <input type="hidden" name="fseq" id="fseq" th:value="${foodVo.food.fseq}">
    <input type="button" value="기록하기" onclick="history_in()">
	<a th:href="@{food_scan(page=${pageInfo.number +1})}">
    	<input type="button" value="목록 보기">
	</a>    
</form>

</body>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="/assets/js/foodDetailChart.js"></script>
<script>

function history_in() {
	$("#food_detail_Form").attr("action", "history_in_from_detail").submit();
}

function show_food_list() {
	
}


function rcd_update() {
    $.ajax({
        type: 'GET',
        url: '/rcd_update',
        dataType: 'json',
        data: $("#fseq"),
        contentType: 'application/x-www-form-urlencoded; charset=utf-8',
        success: function (data) {
        	var result = data.rcdStatus;        	
            var count = data.rcdCount;
            var commentCount = data.commentCount;
            var html = "";            
            if (result == 1) {
            	html = "<span style='color:red'>" + count + "</span>";
            } else if (result == 0) {
            	html = "<span>" + count + "</span>";
            }
            if (result >= 0) {
            	$("#rcdCount").html(html);
            }
        },
        error: function () {
        }
    });
}
</script>
</html>